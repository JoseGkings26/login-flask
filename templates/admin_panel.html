<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administrador</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container admin-container">
        <h2>Panel de Administrador</h2>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <h3>Crear Nuevo Usuario</h3>
        <form action="{{ url_for('admin_panel') }}" method="post">
            <input type="hidden" name="action" value="create_user">
            <div class="input-group">
                <label for="username_new">Nombre de Usuario:</label>
                <input type="text" id="username_new" name="username" required>
            </div>
            <div class="input-group">
                <label for="password_new">Contraseña:</label>
                <input type="password" id="password_new" name="password" required>
            </div>
            <button type="submit">Crear Usuario</button>
        </form>

        <div class="user-list">
            <h3>Usuarios Registrados</h3>
            <ul>
                {% for user in users %}
                    {% if user.username != 'admin_master' %} 
                        <li>
                            {{ user.username }}
                            <form class="delete-form" action="{{ url_for('admin_panel') }}" method="post" onsubmit="return confirm('¿Estás seguro de que quieres eliminar a este usuario?');">
                                <input type="hidden" name="action" value="delete_user">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <button type="submit" class="delete-button">Eliminar</button>
                            </form>
                        </li>
                    {% endif %}
                {% endfor %}

                {% set admin_found = false %}
                {% for user in users %}
                    {% if user.username == 'admin_master' %}
                        {% set admin_found = true %}
                    {% endif %}
                {% endfor %}
                {% if not admin_found %}
                    <li>admin_master (cuenta de administrador principal)</li>
                {% endif %}
            </ul>
        </div>
        
        <p style="text-align: center; margin-top: 30px;"><a href="{{ url_for('logout') }}" class="logout-link">Cerrar Sesión</a></p>
    </div>
</body>
</html>